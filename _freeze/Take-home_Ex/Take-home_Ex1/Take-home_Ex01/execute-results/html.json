{
  "hash": "863e1f886c73dd7835d8479bbcff376a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-home Exercise 1 (WIP)\"\nauthor: \"Yi Fang\"\ndate: \"April 30, 2025\"\ndate-modified: \"last-modified\"\nformat: html\neditor: visual\nfreeze: true\nwarning: false\n---\n\n\n\n**Please note that the following is still a work in progress.**\n\n## 1 Overview\n\n### 1.1 Background\n\nWith reference to [Singstat](https://www.singstat.gov.sg/find-data/search-by-theme/population/population-and-population-structure/latest-data), Singapore’s resident population, consisting of citizens and permanent residents, stands at 4.18 million in 2024, with close to 20% of residents aged 65 and above. The population is distributed across 55 planning areas and 332 subzones. Due to the nation’s limited land space, the majority of its highly urbanized residents live in densely populated areas, a trend that will play a crucial role in shaping the country’s future policies and growth.\n\n### 1.2 Objectives\n\nThis exercise will assume the role of a graphical editor of a media company planning to release an article on demographic structures and distribution of Singapore in 2024.\n\nThe data will be processed by using appropriate **tidyverse** family of packages and the data visualisation will be prepared using **ggplot2** and its extensions.\n\n## 2 Getting started\n\n### 2.1 Load packages\n\nThe following R packages will be loaded using the `pacman::p_load()` function.\n\n-   ggrepel: an R package provides geoms for ggplot2 to repel overlapping text labels.\n\n-   ggthemes: an R package provides some extra themes, geoms, and scales for ‘ggplot2’.\n\n-   hrbrthemes: an R package provides typography-centric themes and theme components for ggplot2.\n\n-   patchwork: an R package for preparing composite figure created using ggplot2.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(ggrepel, patchwork, \n               ggthemes, hrbrthemes,\n               tidyverse, ggplot2, dplyr, scales,\n               ggdist, ggridges, gridExtra, Hmisc) \n```\n:::\n\n\n\n### 2.2 Import data\n\nThis exercise will be using *Singapore Residents by Planning Area / Subzone, Single Year of Age and Sex, June 2024* dataset shared by [Department of Statistics, Singapore (DOS)](https://www.singstat.gov.sg/) Proceed to load the dataset with the following code.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespop_data <- read_csv(\"data/respopagesex2024.csv\")\n```\n:::\n\n\n\n## 3 Data Wrangling\n\nUsing `glimpse()` function, we get an overview of the dataset.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(respop_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 6\n$ PA   <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo K…\n$ SZ   <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang Mo Kio T…\n$ Age  <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"5\", \"6\", …\n$ Sex  <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Females\", \"Male…\n$ Pop  <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, 30, 10, 3…\n$ Time <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,…\n```\n\n\n:::\n:::\n\n\n\nWe see that the dataset has 60,424 rows with 6 columns. It also shows the data type for each column.\n\n### 3.1 Check for duplicates\n\nUsing the duplicated function, we check for duplicates in the dataset.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespop_data[duplicated(respop_data),]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 0 × 6\n# ℹ 6 variables: PA <chr>, SZ <chr>, Age <chr>, Sex <chr>, Pop <dbl>,\n#   Time <dbl>\n```\n\n\n:::\n:::\n\n\n\nAs indicated in the results, there are no duplicates.\n\n### 3.2 Check for missing values\n\nUsing the code below, we will check for missing values.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(column_name in names(respop_data)) {\n  na_count <- sum(is.na(respop_data[[column_name]]))\n\n  if (na_count > 0) {\n    message(\"Column '\", column_name, \"' has \", na_count, \" NA values.\")\n  }\n}\n```\n:::\n\n\n\n### 3.3 Recoding\n\nFor Age column, it is categorical due to the inclusion of an open-ended group, `90_and_Over`. For this exercise, `90_and_Over` was recoded to 90 to ensure that Age could be treated as a numeric variable while still including this group in the analysis. This ensures that the data can be properly analysed and visualised. The following code will recode `90_and_Over` to `90` and cast Age as numeric.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespop_data_clean <- respop_data %>%\n  mutate(Age = ifelse(Age == \"90_and_Over\", \"90\", Age)) %>%\n  mutate(Age = as.numeric(Age))\n```\n:::\n\n\n\n### 3.4 Creating new column\n\nWith reference to [URA Master Plan 2025](https://eservice.ura.gov.sg/maps/?service=MP), the 55 planning areas are classified into their respective regions with the following code.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregion_mapping <- c(\n  \"Ang Mo Kio\" = \"North-East\", \"Bedok\" = \"East\", \"Bishan\" = \"Central\", \n  \"Boon Lay\" = \"West\", \"Bukit Batok\" = \"West\", \"Bukit Merah\" = \"Central\", \n  \"Bukit Panjang\" = \"West\", \"Bukit Timah\" = \"Central\", \"Central Water Catchment\" = \"North\", \n  \"Changi\" = \"East\", \"Changi Bay\" = \"East\", \"Choa Chu Kang\" = \"West\", \n  \"Clementi\" = \"West\", \"Downtown Core\" = \"Central\", \"Geylang\" = \"Central\", \n  \"Hougang\" = \"North-East\", \"Jurong East\" = \"West\", \"Jurong West\" = \"West\", \n  \"Kallang\" = \"Central\", \"Lim Chu Kang\" = \"North\", \"Mandai\" = \"North\", \n  \"Marina East\" = \"Central\", \"Marina South\" = \"Central\", \"Marine Parade\" = \"Central\", \n  \"Museum\" = \"Central\", \"Newton\" = \"Central\", \"North-Eastern Islands\" = \"North-East\", \n  \"Novena\" = \"Central\", \"Orchard\" = \"Central\", \"Outram\" = \"Central\", \n  \"Pasir Ris\" = \"East\", \"Paya Lebar\" = \"East\", \"Pioneer\" = \"West\", \n  \"Punggol\" = \"North-East\", \"Queenstown\" = \"Central\", \"River Valley\" = \"Central\", \n  \"Rochor\" = \"Central\", \"Seletar\" = \"North-East\", \"Sembawang\" = \"North\", \n  \"Sengkang\" = \"North-East\", \"Serangoon\" = \"North-East\", \"Simpang\" = \"North\", \n  \"Singapore River\" = \"Central\", \"Southern Islands\" = \"Central\", \"Straits View\" = \"Central\", \n  \"Sungei Kadut\" = \"North\", \"Tampines\" = \"East\", \"Tanglin\" = \"Central\", \n  \"Tengah\" = \"West\", \"Toa Payoh\" = \"Central\", \"Tuas\" = \"West\", \n  \"Western Islands\" = \"West\", \"Western Water Catchment\" = \"West\", \"Woodlands\" = \"North\", \n  \"Yishun\" = \"North\"\n)\n\nrespop_data_clean <- respop_data_clean %>%\n  mutate(Region = region_mapping[PA])\n```\n:::\n\n\n\n## 4 Data visualisation\n\n### 4.1 Age-Sex Pyramid on a National Level\n\n::: panel-tabset\n## The plot\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-8-1.png){width=1248}\n:::\n:::\n\n\n\n## The code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare data for Population Pyramid\nnational_data <- respop_data_clean %>%\n  group_by(Age, Sex) %>%\n  summarise(Total = sum(Pop, na.rm = TRUE), .groups = 'drop') %>%\n  mutate(\n    Age = as.integer(Age),\n    Total = ifelse(Sex == \"Males\", -Total, Total)  # Make male population negative for pyramid\n  )\n\n# Population Pyramid plot\npyramid_plot <- ggplot(national_data, aes(x = Age, y = Total, fill = Sex)) +\n  geom_bar(stat = \"identity\") +\n  coord_flip() +  # Flip the plot to create a pyramid shape\n  scale_y_continuous(labels = scales::comma_format(accuracy = 1), breaks = scales::pretty_breaks()) +  # Format y-axis\n  labs(\n    title = \"Population Pyramid\",\n    x = \"Age\",\n    y = \"Population\",\n    fill = \"Sex\"\n  ) +\n  theme_minimal() + \n  geom_vline(xintercept = 65, linetype = \"dashed\", color = \"black\", size = 1) +\n  geom_vline(xintercept = 42.8, linetype = \"dashed\", color = \"black\", size = 1) +\n  annotate(\"text\", x = 65, y = 0, label = \"Age 65\", color = \"black\", vjust = -0.5, hjust = -0.1) +\n  annotate(\"text\", x = 42.8, y = 0, label = \"Median Age = 42.8\", color = \"black\", vjust = -0.5, hjust = -0.1) +\n  scale_fill_manual(values = c(\"Males\" = \"steelblue\", \"Females\" = \"salmon\"))\n\n# Prepare data for 100% Stacked Bar Chart\nstacked_data <- respop_data_clean %>%\n  group_by(Age, Sex) %>%\n  summarise(Pop = sum(Pop, na.rm = TRUE), .groups = \"drop\") %>%\n  group_by(Age) %>%\n  mutate(Proportion = Pop / sum(Pop)) %>%\n  ungroup()\n\n# 100% Stacked Bar Chart plot\nstacked_bar_plot <- ggplot(stacked_data, aes(x = as.integer(Age), y = Proportion, fill = Sex)) +\n  geom_bar(stat = \"identity\") +\n  scale_y_continuous(labels = scales::percent_format()) +\n  scale_x_continuous(breaks = seq(0, 90, 10)) +\n  labs(\n    title = \"Age-Sex Distribution\",\n    x = \"Age\",\n    y = \"Proportion within Age Group\",\n    fill = \"Sex\"\n  ) +\n  theme_minimal() +\n  scale_fill_manual(values = c(\"Males\" = \"steelblue\", \"Females\" = \"salmon\"))\n\n# Arrange both plots side by side\ngrid.arrange(pyramid_plot, stacked_bar_plot, ncol = 2)\n```\n:::\n\n\n:::\n\n**Insights**\n\n-   The national population pyramid highlights an ageing demographic, with a prominent bulge at the center of the pyramid. This bulge represents the largest cohort, aged 40 to 54, signals a maturing population.\n-   Furthermore, a notable proportion of individuals fall within the age range of the median age of 42.8 (Singstat, 2024) to 65, the threshold for senior citizens, highlighting the growing proportion of elderly residents.\n-   In contrast, the narrowing base below the median age reflects persistently low birth rates and a shrinking younger population.\n-   The overall shape of the pyramid is symmetrical, indicating a relatively balanced distribution between males and females. However, the females slightly outnumber males in the older age, especially from the late 70s as seen in the stacked bar chart.\n\n### 4.2 Age group distribution across regions\n\n::: panel-tabset\n## The plot\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-10-1.png){width=1248}\n:::\n:::\n\n\n\n## The code\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_group_plot <- respop_data_clean %>%\n  mutate(Age_Group = cut(Age, breaks = c(0, 14, 24, 44, 64, Inf),\n                         labels = c(\"0-14\", \"15-24\", \"25-44\", \"45-64\", \"65+\"))) %>%\n  filter(!is.na(Age_Group)) %>%  \n  group_by(Region, Age_Group) %>%\n  summarise(Total_Pop = sum(Pop, na.rm = TRUE), .groups = \"drop\") %>%\n  mutate(Region = fct_reorder(Region, Total_Pop, .fun = sum, .desc = TRUE)) %>%\n  ggplot(aes(x = Region, y = Total_Pop, fill = Age_Group)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Age Group Distribution by Region\",\n       x = \"Region\", y = \"Population\", fill = \"Age Group\") +\n  scale_fill_manual(values = c(\"0-14\" = \"#FFB6C1\",\n                               \"15-24\" = \"#B3D9FF\", \n                               \"25-44\" = \"#A7D8C7\", \n                               \"45-64\" = \"#FFD1A9\",  \n                               \"65+\" = \"#E0B0FF\")) +  \n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n# Second plot (Slope Chart for Youth vs Senior Population)\nyouth_senior_data <- respop_data_clean %>%\n  mutate(Age_Group = case_when(\n    Age <= 24 ~ \"Youth (0–24)\",\n    Age >= 65 ~ \"Senior (65+)\",\n    TRUE ~ NA_character_\n  )) %>%\n  filter(!is.na(Age_Group)) %>%\n  group_by(Region, Age_Group) %>%\n  summarise(Total_Pop = sum(Pop, na.rm = TRUE), .groups = \"drop\") %>%\n  pivot_wider(names_from = Age_Group, values_from = Total_Pop) %>%\n  mutate(\n    `Youth-to-Senior Ratio` = `Youth (0–24)` / `Senior (65+)`\n  ) %>%\n  pivot_longer(\n    cols = c(`Youth (0–24)`, `Senior (65+)`),\n    names_to = \"Group\",\n    values_to = \"Population\"\n  )\n\n# Slope chart plot\nslope_chart_plot <- ggplot(youth_senior_data, aes(x = Group, y = Population, group = Region)) +\n  geom_line(aes(color = Region), size = 1) +\n  geom_point(aes(color = Region), size = 3) +\n  labs(title = \"Youth vs Senior Population by Region\",\n       subtitle = \"Comparing age structure across regions using a slope chart\",\n       x = \"\", y = \"Population\") +\n  theme_minimal() +\n  theme(legend.position = \"right\")\n\n# Combine both plots side by side\nage_group_plot + slope_chart_plot\n```\n:::\n\n\n:::\n\n**Insights**\n\n-   The North-East region is the most populous, followed closely by the Central and West regions. In contrast, the East and North regions have significantly smaller populations.\n\n-   The North-East also has the highest proportion of children aged 0–14, reinforcing its reputation as a family-oriented region popular with young households.\n\n-   The Central region has the highest concentration of senior citizens (aged 65 and above), followed by the North-East and West regions, while the North region has the smallest senior population.\n\n-   Age groups of 0-14 and 15-24 remain relatively small across all regions, reflecting a broader national trend of declining birth rates.\n\n- The Central region stands out with a near-equal number of youths (aged 0–24) and seniors (65+). Despite signs of ageing, each region still has more youths than seniors, highlighting the continued presence of younger populations alongside an ageing demographic.\n\n### 4.3\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare the data: make sure Age is numeric and Region is a factor\nrespop_data_clean <- respop_data_clean %>%\n  mutate(Age = as.numeric(Age),\n         Region = as.factor(Region))\n\n# Histogram with Population as weight\nggplot(respop_data_clean, aes(x = Age, weight = Pop, fill = Region)) +\n  geom_histogram(binwidth = 1, alpha = 0.6, position = \"stack\") +\n  facet_wrap(~ Region, scales = \"free_y\") +  # Faceting by Region\n  labs(title = \"Age Distribution Across Regions in Singapore (2024)\",\n       subtitle = \"Histogram showing the population distribution by age and region\",\n       x = \"Age\", y = \"Population\") +\n  theme_minimal() +\n  scale_fill_viridis_d(name = \"Region\") +\n  theme(plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(size = 9),\n        axis.title.y = element_text(angle = 0, vjust = 0.5, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Ensure Age is numeric and Pop is used as the weight\nrespop_data_clean <- respop_data_clean %>%\n  mutate(Age = as.numeric(Age))  # Ensure Age is numeric\n\n# Create weighted violin plot for Age distribution across regions\nggplot(respop_data_clean, aes(x = Region, y = Age, weight = Pop, fill = Region)) +\n  geom_violin(alpha = 0.6) +  # Violin plot with transparency\n  labs(title = \"Age Distribution Across Regions in Singapore (2024)\",\n       subtitle = \"Violin plot showing the age distribution by region, weighted by population\",\n       x = \"Region\", y = \"Age\") +\n  theme_minimal() +\n  scale_fill_viridis_d(name = \"Region\") +  # Color by Region\n  theme(plot.title = element_text(hjust = 0.5),\n        plot.subtitle = element_text(size = 9),\n        axis.title.y = element_text(angle = 0, vjust = 0.5, hjust = 1),\n        axis.title.x = element_text(vjust = 0.5),\n        strip.text = element_text(size = 10))  # Adjust facet label size\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(respop_data_clean, aes(x = Age, weight = Pop, fill = Sex)) +\n  geom_density(alpha = 0.6) +\n  facet_wrap(~ Region, ncol = 1, scales = \"free_y\") +\n  labs(\n    title = \"Age Distribution by Region and Gender (2024)\",\n    x = \"Age\",\n    y = \"Density\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    strip.text = element_text(face = \"bold\"),\n    axis.text.y = element_blank(),\n    legend.title = element_blank()\n  ) +\n  scale_fill_manual(values = c(\"Males\" = \"steelblue\", \"Females\" = \"salmon\"))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Prepare the data: make sure Age is numeric and Region is a factor\nrespop_data_clean <- respop_data_clean %>%\n  mutate(Age = as.numeric(Age),\n         Region = as.factor(Region))\n\n# Histogram with Population as weight, vertically stacked by Region\nggplot(respop_data_clean, aes(x = Age, weight = Pop, fill = Region)) +\n  geom_histogram(binwidth = 1, alpha = 0.6, position = \"stack\") +\n  facet_wrap(~ Region, ncol = 1, scales = \"free_y\") +  # <-- ncol = 1 for vertical stacking\n  labs(title = \"Age Distribution Across Regions in Singapore (2024)\",\n       subtitle = \"Histogram showing the population distribution by age and region\",\n       x = \"Age\", y = \"Population\") +\n  theme_minimal() +\n  scale_fill_viridis_d(name = \"Region\") +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    plot.subtitle = element_text(size = 9),\n    axis.title.y = element_text(angle = 0, vjust = 0.5, hjust = 1)\n  )\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrespop_data_clean %>%\n  ggplot(aes(x = Age, y = Region, \n             height = after_stat(density), \n             fill = Region, weight = Pop)) +\n  geom_density_ridges(stat = \"density\", scale = 3, alpha = 0.7, color = \"white\") +\n  labs(title = \"Weighted Age Density Distribution by Region\",\n       x = \"Age\", y = \"Region\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbox_data <- respop_data_clean %>%\n  group_by(Region) %>%\n  summarise(\n    Min = wtd.quantile(Age, weights = Pop, probs = 0, na.rm = TRUE),\n    Q1 = wtd.quantile(Age, weights = Pop, probs = 0.25, na.rm = TRUE),\n    Median = wtd.quantile(Age, weights = Pop, probs = 0.5, na.rm = TRUE),\n    Mean = weighted.mean(Age, w = Pop, na.rm = TRUE),\n    Q3 = wtd.quantile(Age, weights = Pop, probs = 0.75, na.rm = TRUE),\n    Max = wtd.quantile(Age, weights = Pop, probs = 1, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\n# Create the plot with weighted quantiles\nggplot(box_data, aes(y = Region)) +  # Set y = Region for the horizontal plot\n  # Boxplot elements using geom_segment\n  geom_segment(aes(x = Min, xend = Max, y = Region, yend = Region), size = 1, color = \"black\") +  # Whiskers (Min, Max)\n  geom_segment(aes(x = Q1, xend = Q3, y = Region, yend = Region), size = 5, color = \"#8593B5\") +  # Box (Q1 to Q3)\n  geom_point(aes(x = Mean, y = Region), size = 4, color = \"#8F6798\") +  # Mean as dot\n  geom_segment(aes(x = Median, xend = Median, y = Region, yend = Region), size = 1.5, color = \"red\") +  # Median line inside box\n  labs(title = \"Horizontal Weighted Boxplot of Age by Region\",\n       x = \"Age\", y = \"Region\") +\n  theme_minimal() +\n  theme(axis.text.y = element_text(angle = 45, hjust = 1)) +\n  coord_cartesian(xlim = c(0, 100))\n```\n\n::: {.cell-output-display}\n![](Take-home_Ex01_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n## 5 Reference\n\n-   [Singstat](https://www.singstat.gov.sg/find-data/search-by-theme/population/population-and-population-structure/latest-data)\n",
    "supporting": [
      "Take-home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}